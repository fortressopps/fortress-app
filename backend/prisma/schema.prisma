generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================================================
// MODELS (iguais ao seu, funcionando 100% no Prisma 7)
// ============================================================================

model Account {
  id           String        @id @default(cuid())
  name         String
  type         AccountType
  balance      Float         @default(0)
  currency     String        @default("BRL")
  institution  String?
  color        String        @default("#6b7280")
  isActive     Boolean       @default(true)

  userId       String
  user         User          @relation(fields: [userId], references: [id])

  transactions Transaction[]

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("accounts")
}

model Transaction {
  id               String          @id @default(cuid())
  amount           Float
  type             TransactionType
  category         String
  description      String?
  date             DateTime
  recurringPattern String?
  notes            String?
  isRecurring      Boolean         @default(false)

  accountId String
  account   Account @relation(fields: [accountId], references: [id])

  userId    String
  user      User    @relation(fields: [userId], references: [id])

  supermarketListId String?
  supermarketList   SupermarketList? @relation(fields: [supermarketListId], references: [id])

  tags              Tag[] @relation("TransactionTags")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, date])
  @@index([accountId, date])
  @@map("transactions")
}

model Tag {
  id           String        @id @default(cuid())
  name         String        @unique

  transactions Transaction[] @relation("TransactionTags")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tags")
}

model SupermarketList {
  id          String    @id @default(cuid())
  name        String
  budget      Float
  spent       Float     @default(0)
  storeName   String?
  completed   Boolean   @default(false)
  completedAt DateTime?

  userId       String
  user         User              @relation(fields: [userId], references: [id])
  items        SupermarketItem[]
  transactions Transaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("supermarket_lists")
}

model SupermarketItem {
  id             String              @id @default(cuid())
  name           String
  category       SupermarketCategory
  estimatedPrice Float
  actualPrice    Float?
  quantity       Int                 @default(1)
  unit           String?
  purchased      Boolean             @default(false)
  notes          String?

  listId String
  list   SupermarketList @relation(fields: [listId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([listId, category])
  @@map("supermarket_items")
}

model Budget {
  id             String       @id @default(cuid())
  category       String
  amount         Float
  period         BudgetPeriod @default(MONTHLY)
  spent          Float        @default(0)
  startDate      DateTime
  endDate        DateTime
  alertsEnabled  Boolean      @default(true)
  alertThreshold Float        @default(0.8)

  userId String
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, category, startDate])
  @@map("budgets")
}

model User {
  id             String    @id @default(cuid())
  email          String    @unique
  name           String?
  planType       PlanType  @default(SENTINEL)
  subscriptionId String?
  trialEndsAt    DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  accounts         Account[]
  transactions     Transaction[]
  supermarketLists SupermarketList[]
  budgets          Budget[]

  lastLoginAt DateTime?

  @@map("users")
}

// ============================================================================
// ENUMS
// ============================================================================
enum PlanType {
  SENTINEL
  VANGUARD
  LEGACY
}

enum AccountType {
  CHECKING
  SAVINGS
  CREDIT
  INVESTMENT
  CASH
  OTHER
}

enum TransactionType {
  INCOME
  EXPENSE
  TRANSFER
}

enum SupermarketCategory {
  PRODUCE
  BAKERY
  MEAT
  DAIRY
  HOUSEHOLD
  BEVERAGES
  PERSONAL_CARE
  FROZEN
  PANTRY
  OTHER
}

enum BudgetPeriod {
  WEEKLY
  MONTHLY
  YEARLY
}
